---
title: "Introduction to ecoflex"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction to ecoflex}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width = 7,
  fig.height = 5
)
library(ecoflex)
```

## Overview

**ecoflex** provides a unified, flexible interface for advanced econometric
models that are commonly used in applied microeconomics, causal inference,
and structural estimation research. The package collects eight model families
under a single consistent API, making it easy to estimate, compare, and
report results.

## Model Families

| Module            | Function            | Key Features |
|:------------------|:--------------------|:-------------|
| Hurdle            | `hurdle_flex()`     | Arbitrary threshold, ML/two-step, Poisson/NegBin/Geometric |
| Heckman Selection | `heckman_flex()`    | ML/two-step/Lee/semiparametric, normal/t errors |
| RDD               | `rdd_flex()`        | Sharp/fuzzy, local polynomial, MSE-optimal bandwidth |
| IV/GMM            | `ivgmm_flex()`      | 2SLS/LIML/Fuller/GMM two-step/iterative/CUE |
| DiD               | `did_flex()`        | TWFE + 6 modern heterogeneity-robust estimators |
| Tobit             | `tobit_flex()`      | Types I–V, normal/t/logistic errors, censored LAD |
| Nonlinear Panel   | `panel_nl()`        | FE/RE/Correlated RE, Poisson/NegBin/Logit/Probit/Gamma |
| Switching         | `switching_flex()`  | Exogenous/endogenous/Markov switching |

## Unified Interface

All models return objects inheriting from `"ecoflex"`, which means the same
generics work across models:

- `summary()`, `print()` — formatted coefficient tables
- `coef()`, `vcov()`, `logLik()`, `nobs()` — standard extractors
- `predict()` — fitted values and predictions
- `flex_vcov()` — post-estimation robust/cluster/bootstrap vcov

## Quick Example: Hurdle Model

```{r hurdle-example, eval = FALSE}
set.seed(42)
n <- 1000
x <- rnorm(n)
y <- rpois(n, exp(0.5 + 0.3 * x))

df <- data.frame(y = y, x = x)

# Joint ML hurdle with threshold = 0
m <- hurdle_flex(y ~ x, data = df, threshold = 0)
summary(m)
```

## Quick Example: RDD

```{r rdd-example, eval = FALSE}
x <- runif(1000, -1, 1)
y <- 1 + 0.5 * x + 2 * (x >= 0) + rnorm(1000, sd = 0.5)
df <- data.frame(y = y, x = x)

m <- rdd_flex(y ~ x, data = df, cutoff = 0, type = "sharp")
summary(m)

# Diagnostics
rdd_manipulation_test(df$x, cutoff = 0)
```

## Quick Example: IV/GMM

```{r iv-example, eval = FALSE}
n <- 500
z <- rnorm(n); x <- 0.5 * z + rnorm(n)
y <- 1 + 2 * x + rnorm(n)
df <- data.frame(y = y, x = x, z = z)

m <- ivgmm_flex(y ~ x | z, data = df, method = "2sls")
summary(m)
m$diagnostics$weak_iv_test
```

## Flexible Standard Errors

Use `flex_vcov()` to compute alternative variance-covariance matrices:

```{r vcov-example, eval = FALSE}
# Cluster-robust SE
V_cl <- flex_vcov(m, type = "cluster", cluster = df$cluster_id)

# Bootstrap SE
V_boot <- flex_vcov(m, type = "bootstrap", R = 1000)
```

## Further Reading

See individual model vignettes for detailed examples and methodological notes:

- `vignette("hurdle_models", package = "ecoflex")`
- `vignette("heckman_selection", package = "ecoflex")`
- `vignette("rdd", package = "ecoflex")`
- `vignette("iv_gmm", package = "ecoflex")`
- `vignette("did", package = "ecoflex")`
- `vignette("tobit", package = "ecoflex")`
- `vignette("panel_nonlinear", package = "ecoflex")`
- `vignette("switching_regression", package = "ecoflex")`
